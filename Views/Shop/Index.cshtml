@model IEnumerable<LoginPanel.Models.ProductModel>
@{
    ViewBag.Title = "Products";
    Layout = "~/Views/Shared/ShopLayout.cshtml";
}

@functions {
    string ImgByProduct(string name)
    {
        var n = (name ?? "").Trim().ToLower();

        if (n.Contains("pixel 8") || (n.Contains("google") && n.Contains("pixel"))) //ok
            return "/images/GooglePixel8.png";

        if (n.Contains("apple macbook air") || (n.Contains("apple") && n.Contains("macbook") && n.Contains("air"))) //ok
            return "/images/AppleMacBook.png";

        if (n.Contains("iphone 15") || (n.Contains("iphone") && n.Contains("15"))) //ok
            return "/images/iphone15.jpg";

        if (n.Contains("acer aspire 7") || (n.Contains("acer") && n.Contains("aspire")))
            return "/images/Acer.png";

        if (n.Contains("thinkpad") || n.Contains("lenovo"))  //ok
            return "/images/LenovoThinkPad.png";

        // ✅ FIX: lowercase
        if (n.Contains("hp pavilion 15") || (n.Contains("hp") && n.Contains("pavilion")))  //ok
            return "/images/HPPAVILION1.png";

        if (n.Contains("dell xps") || (n.Contains("dell") && n.Contains("xps")))  //ok
            return "/images/delllaptop04.png";

        if (n.Contains("samsung a54") || n.Contains("a54"))  //ok
            return "/images/samsunga.jpg";

        if (n.Contains("samsung galaxy s24") || (n.Contains("samsung") && n.Contains("s24")) || n.Contains("s24"))  //ok
            return "/images/samsung24.png";

        if (n.Contains("redmi note") || n.Contains("xiaomi") || n.Contains("redmi"))  //ok
            return "/images/redminote.jpg";

        if (n.Contains("oneplus"))  //ok
            return "/images/oneplus.jpg";

        if (n.Contains("realme gt neo 3") || (n.Contains("realme") && n.Contains("neo") && n.Contains("3")) || n.Contains("gt neo 3"))
            return "/images/Realme1.png";

        return "/images/no-image.jpg";
    }
}

<style>
    /* ===== Slider (FIX: same height for all slides) ===== */
    #homeSlider .carousel-inner {
        height: 420px; /* ✅ same height */
    }

    #homeSlider .carousel-item {
        height: 100%;
    }

    #homeSlider .slider-img {
        width: 100%;
        height: 100%; /* ✅ fill carousel height */
        object-fit: cover; /* ✅ no stretch, perfect cover */
        /* display: block; */
    }

    @@media (max-width: 768px) {
        #homeSlider .carousel-inner {
            height: 230px;
        }
    }

    .slider-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, rgba(0,0,0,.55), rgba(0,0,0,.15), rgba(0,0,0,.55));
    }

    .carousel-control-prev, .carousel-control-next {
        width: 10%;
        opacity: 1;
    }

    .carousel-control-prev-icon,
    .carousel-control-next-icon {
        filter: drop-shadow(0 6px 12px rgba(0,0,0,.65));
        transform: scale(1.05); 
    }

    /* ===== Product Cards ===== */
    .p-card {
        border: 1px solid rgba(15,23,42,.08);
        border-radius: 18px;
        overflow: hidden;
        transition: .2s;
        /* transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
        background: #fff; */
    }

        .p-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 16px 40px rgba(2,6,23,.14);
            /* border-color: rgba(99,102,241,.25); */
        }

    .p-img-wrap {
        height: 210px; /* fixed box for all */
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative; /*new add*/
    }

    .p-img {
        max-height: 180px;
        max-width: 100%;
        object-fit: contain; /* product full visible */
        /* display: block; */
    }
    .p-card:hover .p-img {
        transform: scale(1.04);
    }

    .line-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    /*
    .price {
        font-size: 1.05rem;
        font-weight: 800;
        letter-spacing: .2px;
    } */
    .p-badges {
        position: absolute;
        top: 12px;
        left: 12px;
        z-index: 5;
    }

    .p-badge {
        background: #111827; /* dark neutral */
        color: #fff;
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 600;
        border-radius: 6px;
        letter-spacing: .3px;
    }

    .badge-out {
        background: #6b7280;
    }

    .badge-discount {
        background: #b91c1c;
    }

    .price {
        font-size: 1.1rem;
        font-weight: 800;
    } 
    .price-wrap {
        text-align: center;
        margin-bottom: 6px;
    }

    .price-current {
        font-size: 1.15rem;
        font-weight: 800;
        color: #111827;
    }

    .price-mrp {
        font-size: 0.9rem;
        color: #6b7280;
        text-decoration: line-through;
        margin-left: 6px;
    }

    .price-save {
        font-size: 0.85rem;
        color: #059669; /* green */
        font-weight: 600;
    }
</style>

<!-- ✅ Slider (Home Banner) -->
<div id="homeSlider" class="carousel slide mb-4 overflow-hidden rounded-4 shadow" data-bs-ride="carousel">

    <!-- ✅ Indicators (dots) -->
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#homeSlider" data-bs-slide-to="0" class="active" aria-current="true"></button>
        <button type="button" data-bs-target="#homeSlider" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#homeSlider" data-bs-slide-to="2"></button>
    </div>

    <div class="carousel-inner">

        <div class="carousel-item active position-relative">
            <img src="@Url.Content("~/images/slider3.png")" class="d-block w-100 slider-img" alt="Slide 1">
            <div class="slider-overlay"></div>
            <div class="carousel-caption text-start">
             </div>
        </div>

        <div class="carousel-item position-relative">
            <img src="@Url.Content("~/images/slider2.png")" class="d-block w-100 slider-img" alt="Slide 2">
            <div class="slider-overlay"></div>
            <div class="carousel-caption">
            </div>
        </div>

        <div class="carousel-item position-relative">
            <img src="@Url.Content("~/images/slider3.png")" class="d-block w-100 slider-img" alt="Slide 3">
            <div class="slider-overlay"></div>
            <div class="carousel-caption text-end">
            </div>
        </div>

    </div>

    <!-- ✅ Left/Right Buttons -->
    <button class="carousel-control-prev" type="button" data-bs-target="#homeSlider" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>

    <button class="carousel-control-next" type="button" data-bs-target="#homeSlider" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<!-- Heading -->
@* <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <h3 class="mb-0">Products</h3>
</div> *@

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="row g-3">
    @foreach (var p in Model)
    {
        <div class="col-sm-6 col-lg-4 col-xl-3">
            <div class="p-card h-100">

                
                <div class="p-img-wrap">

                    <!-- 🔖 PRODUCT BADGES -->
                    <div class="p-badges">

                        @* Highest priority *@
                        @if (p.AvailableQty <= 0)
                        {
                            <span class="p-badge badge-out">OUT OF STOCK</span>
                        }
                        else
                        {
                            var mrp = p.ProductPrice + (p.ProductPrice * 20 / 100);
                            var discount = (int)((mrp - p.ProductPrice) * 100 / mrp);

                            @* Show ONLY ONE main badge *@
                            if (discount >= 10)
                            {
                                <span class="p-badge badge-discount">@discount% OFF</span>
                            }
                            else if (p.ProductName.ToLower().Contains("iphone") ||
                            p.ProductName.ToLower().Contains("samsung"))
                            {
                                <span class="p-badge">BEST SELLER</span>
                            }
                        }

                    </div>
                    <!-- 🖼 PRODUCT IMAGE -->
                    <a href="@Url.Action("Details", "Shop", new { id = p.ProductId })"
                       class="text-decoration-none"
                       data-bs-toggle="tooltip"
                       data-bs-title="View details">
                        <img src="@ImgByProduct(p.ProductName)"
                             class="p-img"
                             alt="@p.ProductName"
                             onerror="this.src='/images/no-image.jpg'">
                    </a>

                </div>


                <div class="card-body d-flex flex-column">

                    <div class="mb-1 text-center">
                        <a class="text-decoration-none text-dark fw-bold d-block line-2"
                           href="@Url.Action("Details", "Shop", new { id = p.ProductId })"
                           data-bs-toggle="tooltip"
                           data-bs-title="Open product">
                            @p.ProductName
                        </a>
                    </div>


                    <!-- ✅ Price -->
                    @{
                        decimal mrpPrice = p.ProductPrice + (p.ProductPrice * 20m / 100m);
                        decimal saveAmount = mrpPrice - p.ProductPrice;
                    }

                    <div class="text-center mb-2">

                        <!-- MRP -->
                        <div class="text-muted small">
                            MRP
                            <span style="text-decoration:line-through;">
                                ₹ @mrpPrice
                            </span>
                        </div>

                        <!-- Selling Price -->
                        <div class="price">
                            ₹ @p.ProductPrice
                        </div>

                        <!-- You Save -->
                        @if (saveAmount > 0)
                        {
                            <div class="text-success small fw-semibold">
                                You save ₹ @saveAmount
                            </div>
                        }
                    </div>

                    @if (p.AvailableQty <= 2 && p.AvailableQty > 0)
                    {
                        <div class="text-danger fw-semibold text-center mb-3">
                            🔥 Only @p.AvailableQty left in stock
                        </div>
                    }
                    else
                    {
                        <div class="small text-muted mb-3 text-center">
                            Available: <b>@p.AvailableQty</b>
                        </div>
                    }



                    <div class="mt-auto">
                        @if (p.AvailableQty <= 0)
                        {
                            <button class="btn btn-secondary w-100" disabled>
                                Out of Stock
                            </button>
                        }
                        else
                        {
                            <a class="btn btn-dark w-100"
                               href="@Url.Action("BuyNow", "Shop", new { id = p.ProductId })"
                               data-bs-toggle="tooltip" data-bs-title="Add to cart">
                                <i class="bi bi-cart3 me-1"></i> Buy
                            </a>
                        }
                    </div>

                </div>
            </div>
        </div>
    }
</div>

<!-- ✅ Tooltip Init (Bootstrap) -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const list = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        list.forEach(el => new bootstrap.Tooltip(el));
    });
</script>
